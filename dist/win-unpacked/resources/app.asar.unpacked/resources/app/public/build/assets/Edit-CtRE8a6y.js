import{u as K,r as S,j as e,H as Q,L as A,a as X}from"./app-Doa1X8LG.js";import{B as c}from"./button-D4rUH4JB.js";import{C as j,a as u,b as p,c as F,d as g}from"./card-DF370HhO.js";import{I as E}from"./input-Dc5R9TS5.js";import{L as f}from"./label-HbfnK1lI.js";import{S as P,a as L,b as D,c as k,d as H,P as V}from"./select-ZapHPyF4.js";import{T as Y,a as Z,b as w,c as n,d as ee,e as i}from"./table-DBCaEuI0.js";import{A as se}from"./authenticated-layout-zkXyR4IY.js";import{E as ae}from"./eye-CfbH9hpu.js";import{A as te}from"./arrow-left-DUbe0Jwt.js";import{S as B}from"./square-pen-Dxq6FGvn.js";import{P as $}from"./app-header-layout-DeCsVdE4.js";import{T as re}from"./trash-2-DTPMTCxV.js";import{C as le}from"./calculator-CCaaTO6w.js";/* empty css            */import"./index-Cxkacx_1.js";import"./index-CUR25A5V.js";import"./check-DpiK8D10.js";import"./app-logo-icon-CJVXHink.js";function Ie({invoice:l,warehouses:z,items:N,defaultWarehouse:ie}){const{data:r,setData:b,put:R,processing:C,errors:d}=K({warehouse_id:l.warehouse_id.toString(),items:l.items.map(s=>({item_id:s.item_id,amount:s.amount,price:s.price}))}),[m,I]=S.useState(""),[o,_]=S.useState(""),[x,y]=S.useState(""),T=()=>r.items.reduce((s,a)=>s+a.amount*a.price,0),M=()=>{if(!m||!o||!x)return;const s=parseInt(m),a=parseFloat(o),t=parseFloat(x);if(r.items.some(J=>J.item_id===s)){alert("Este item ya está agregado a la factura");return}const v={item_id:s,amount:a,price:t,subtotal:a*t};b("items",[...r.items,v]),I(""),_(""),y("")},q=s=>{const a=r.items.filter((t,v)=>v!==s);b("items",a)},G=s=>{I(s);const a=N.find(t=>t.id===parseInt(s));a&&y(a.price.toString())},O=s=>{if(s.preventDefault(),r.items.length===0){alert("Debe agregar al menos un item a la factura");return}R(route("invoices.update",l.id))},h=s=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"USD"}).format(s),U=s=>N.find(a=>a.id===s),W=[{title:"Panel de Control",href:"/dashboard"},{title:"Facturas",href:"/invoices"},{title:l.code,href:`/invoices/${l.id}`},{title:"Editar",href:`/invoices/${l.id}/edit`}];return e.jsxs(se,{breadcrumbs:W,children:[e.jsx(Q,{title:`Editar Factura ${l.code}`}),e.jsx("div",{className:"space-y-6 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Editar Factura"}),e.jsxs("p",{className:"mt-1 text-gray-600",children:["Modifica la factura ",l.code," y sus items"]})]}),e.jsx(c,{asChild:!0,children:e.jsxs(A,{href:`/invoices/${l.id}`,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Ver Detalle"]})}),e.jsx(A,{href:"/invoices",children:e.jsxs(c,{variant:"outline",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Volver"]})})]})}),e.jsx("div",{className:"pb-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs(j,{children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"Información General"]}),e.jsx(F,{children:"Modifica el almacén para la factura"})]}),e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(f,{htmlFor:"warehouse_id",children:"Almacén *"}),e.jsxs(P,{value:r.warehouse_id.toString(),onValueChange:s=>b("warehouse_id",s),children:[e.jsx(L,{children:e.jsx(D,{placeholder:"Seleccionar almacén"})}),e.jsx(k,{children:z.map(s=>e.jsx(H,{value:s.id.toString(),children:s.display_name},s.id))})]}),d.warehouse_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.warehouse_id})]})})]}),e.jsxs(j,{children:[e.jsxs(u,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Agregar Items"]}),e.jsx(F,{children:"Agrega más items a la factura de forma rápida y dinámica"})]}),e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"item_select",children:"Item"}),e.jsxs(P,{value:m,onValueChange:G,children:[e.jsx(L,{children:e.jsx(D,{placeholder:"Seleccionar item"})}),e.jsx(k,{children:N.map(s=>e.jsx(H,{value:s.id.toString(),children:s.display_name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"amount",children:"Cantidad"}),e.jsx(E,{id:"amount",type:"number",step:"0.01",min:"0.01",placeholder:"0.00",value:o,onChange:s=>_(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"price",children:"Precio"}),e.jsx(E,{id:"price",type:"number",step:"0.01",min:"0.01",placeholder:"0.00",value:x,onChange:s=>y(s.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(c,{type:"button",onClick:M,disabled:!m||!o||!x,className:"w-full",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Agregar"]})})]})})]}),e.jsxs(j,{children:[e.jsx(u,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Items de la Factura (",r.items.length,")"]})}),e.jsxs(g,{children:[r.items.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx($,{className:"mx-auto mb-4 h-12 w-12 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No hay items agregados"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Agrega items usando el formulario de arriba"})]}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(w,{children:[e.jsx(n,{children:"Item"}),e.jsx(n,{className:"text-right",children:"Cantidad"}),e.jsx(n,{className:"text-right",children:"Precio"}),e.jsx(n,{className:"text-right",children:"Subtotal"}),e.jsx(n,{className:"w-[100px]",children:"Acciones"})]})}),e.jsxs(ee,{children:[r.items.map((s,a)=>{const t=U(s.item_id);return e.jsxs(w,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t==null?void 0:t.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t==null?void 0:t.code," • ",t==null?void 0:t.unit]})]})}),e.jsx(i,{className:"text-right",children:Number(s.amount).toFixed(2)}),e.jsx(i,{className:"text-right",children:h(s.price)}),e.jsx(i,{className:"text-right font-medium",children:h(s.amount*s.price)}),e.jsx(i,{children:e.jsx(c,{type:"button",variant:"ghost",size:"sm",onClick:()=>q(a),children:e.jsx(re,{className:"h-4 w-4 text-red-500"})})})]},a)}),e.jsxs(w,{className:"border-t-2 bg-gray-50",children:[e.jsx(i,{colSpan:3,className:"text-right font-bold",children:"TOTAL:"}),e.jsx(i,{className:"text-right",children:e.jsx("span",{className:"text-xl font-bold text-green-600",children:h(T())})}),e.jsx(i,{})]})]})]})}),d.items&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:d.items})]})]}),e.jsxs(j,{children:[e.jsx(u,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Resumen"]})}),e.jsxs(g,{children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Total de Items: ",r.items.length]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["Total: ",h(T())]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(c,{type:"submit",disabled:C||r.items.length===0,className:"flex-1",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),C?"Actualizando...":"Actualizar Factura"]}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>X.visit(route("invoices.show",l.id)),children:"Cancelar"})]})]})]})]})})})]})}export{Ie as default};
