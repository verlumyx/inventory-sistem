import{u as W,r as p,j as e,H as ee,L as b}from"./app-Doa1X8LG.js";import{A as se}from"./authenticated-layout-zkXyR4IY.js";import{B as m}from"./button-D4rUH4JB.js";import{I as y}from"./input-Dc5R9TS5.js";import{L as c}from"./label-HbfnK1lI.js";import{T as ae}from"./textarea-CC5ZfQwb.js";import{C,a as w,b as S,c as B,d as _}from"./card-DF370HhO.js";import{P as k,S as H,a as P,b as V,c as $,d as z}from"./select-ZapHPyF4.js";import{A as q,a as M}from"./alert-zFhh9Z1D.js";import{T as te,a as ie,b as R,c as u,d as re,e as g}from"./table-DBCaEuI0.js";import{E as de}from"./eye-CfbH9hpu.js";import{A as le}from"./arrow-left-DUbe0Jwt.js";import{L as ce}from"./lock-CP4iIsAc.js";import{C as N}from"./circle-alert-B5xY-sIk.js";import{P as G}from"./app-header-layout-DeCsVdE4.js";import{T as ne}from"./trash-2-DTPMTCxV.js";/* empty css            */import"./index-Cxkacx_1.js";import"./index-CUR25A5V.js";import"./check-DpiK8D10.js";import"./app-logo-icon-CJVXHink.js";function De({entry:t,items:f,warehouses:v,defaultWarehouse:n}){var D;const{data:r,setData:o,put:J,processing:A,errors:l}=W({name:t.name,description:t.description||"",status:t.status,items:[]});p.useEffect(()=>{const s=t.items.map(a=>({id:a.id,item_id:a.item_id,warehouse_id:a.warehouse_id,amount:a.amount,item:a.item,warehouse:a.warehouse}));o("items",s)},[t.items]);const K=s=>{s.preventDefault(),J(route("entries.update",t.id))},[x,I]=p.useState(""),[h,E]=p.useState(((D=n==null?void 0:n.id)==null?void 0:D.toString())||""),[j,T]=p.useState(""),O=()=>{var F;if(!x||!h||!j)return;const s=parseInt(x),a=parseInt(h),i=parseFloat(j);if(r.items.some(L=>L.item_id===s&&L.warehouse_id===a)){alert("Este item ya está agregado en este almacén");return}const d={item_id:s,warehouse_id:a,amount:i};o("items",[...r.items,d]),I(""),E(((F=n==null?void 0:n.id)==null?void 0:F.toString())||""),T("")},Q=s=>{const a=r.items.filter((i,d)=>d!==s);o("items",a)},U=s=>f.find(a=>a.id===s),X=s=>v.find(a=>a.id===s),Y=()=>r.name.trim()!==""&&r.items.length>0&&r.items.every(s=>s.item_id>0&&s.warehouse_id>0&&s.amount>0),Z=[{title:"Panel de Control",href:"/dashboard"},{title:"Entradas",href:"/entries"},{title:t.code,href:`/entries/${t.id}`},{title:"Editar",href:`/entries/${t.id}/edit`}];return e.jsxs(se,{breadcrumbs:Z,children:[e.jsx(ee,{title:`Editar Entrada - ${t.code}`}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Editar Entrada"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Modifica la entrada ",t.code," y sus items"]})]}),e.jsx(m,{asChild:!0,children:e.jsxs(b,{href:`/entries/${t.id}`,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Ver Detalle"]})}),e.jsx(b,{href:"/entries",children:e.jsxs(m,{variant:"outline",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Volver"]})})]}),e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs(C,{children:[e.jsxs(w,{children:[e.jsx(S,{children:"Información Básica"}),e.jsx(B,{children:"Datos generales de la entrada"})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"code",children:"Código"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"code",type:"text",value:t.code,disabled:!0,className:"bg-gray-50"}),e.jsx(ce,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"El código de la entrada no se puede modificar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Nombre *"}),e.jsx(y,{id:"name",type:"text",value:r.name,onChange:s=>o("name",s.target.value),placeholder:"Nombre de la entrada",className:l.name?"border-red-500":"",required:!0}),l.name&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(N,{className:"h-4 w-4"}),l.name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Nombre descriptivo de la entrada (requerido, máximo 255 caracteres)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Descripción"}),e.jsx(ae,{id:"description",value:r.description,onChange:s=>o("description",s.target.value),placeholder:"Descripción opcional de la entrada",rows:4,className:l.description?"border-red-500":""}),l.description&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(N,{className:"h-4 w-4"}),l.description]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Descripción detallada de la entrada (opcional)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-medium text-gray-500",children:"Fecha de Creación"}),e.jsx("p",{className:"text-sm text-gray-900",children:new Date(t.created_at).toLocaleString("es-ES")})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-medium text-gray-500",children:"Última Modificación"}),e.jsx("p",{className:"text-sm text-gray-900",children:new Date(t.updated_at).toLocaleString("es-ES")})]})]})]})]}),e.jsxs(C,{children:[e.jsxs(w,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Agregar Items"]}),e.jsx(B,{children:"Agrega más items a la entrada de forma rápida y dinámica"})]}),e.jsx(_,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"item_select",children:"Item"}),e.jsxs(H,{value:x,onValueChange:I,children:[e.jsx(P,{children:e.jsx(V,{placeholder:"Seleccionar item"})}),e.jsx($,{children:f.map(s=>e.jsx(z,{value:s.id.toString(),children:s.display_name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"warehouse_select",children:"Almacén"}),e.jsxs(H,{value:h,onValueChange:E,children:[e.jsx(P,{children:e.jsx(V,{placeholder:"Seleccionar almacén"})}),e.jsx($,{children:v.map(s=>e.jsx(z,{value:s.id.toString(),children:s.display_name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"amount",children:"Cantidad"}),e.jsx(y,{id:"amount",type:"number",step:"0.01",min:"0.01",placeholder:"0.00",value:j,onChange:s=>T(s.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(m,{type:"button",onClick:O,disabled:!x||!h||!j,className:"w-full",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Agregar"]})})]})})]}),e.jsxs(C,{children:[e.jsx(w,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Items de la Entrada (",r.items.length,")"]})}),e.jsxs(_,{children:[f.length===0&&e.jsxs(q,{children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(M,{children:"No hay items disponibles. Crea algunos items primero."})]}),v.length===0&&e.jsxs(q,{children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(M,{children:"No hay almacenes disponibles. Crea algunos almacenes primero."})]}),r.items.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No hay items agregados"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Agrega items usando el formulario de arriba"})]}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(te,{children:[e.jsx(ie,{children:e.jsxs(R,{children:[e.jsx(u,{children:"Item"}),e.jsx(u,{children:"Almacén"}),e.jsx(u,{className:"text-right",children:"Cantidad"}),e.jsx(u,{className:"w-[100px]",children:"Acciones"})]})}),e.jsx(re,{children:r.items.map((s,a)=>{const i=U(s.item_id)||s.item,d=X(s.warehouse_id)||s.warehouse;return e.jsxs(R,{children:[e.jsx(g,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i==null?void 0:i.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[i==null?void 0:i.code," • ",i==null?void 0:i.unit]})]})}),e.jsx(g,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:d==null?void 0:d.name}),e.jsx("div",{className:"text-sm text-gray-500",children:d==null?void 0:d.code})]})}),e.jsx(g,{className:"text-right",children:Number(s.amount).toFixed(2)}),e.jsx(g,{children:e.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>Q(a),children:e.jsx(ne,{className:"h-4 w-4 text-red-500"})})})]},a)})})]})}),l.items&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:l.items})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[e.jsx(b,{href:route("entries.show",t.id),children:e.jsx(m,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(m,{type:"submit",disabled:A||!Y(),children:A?"Actualizando...":"Actualizar Entrada"})]})]})]})]})}export{De as default};
