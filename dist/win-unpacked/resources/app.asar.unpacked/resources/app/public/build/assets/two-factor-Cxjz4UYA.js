import{b as de,r as f,u as p,j as e,H as le}from"./app-Doa1X8LG.js";import{S as ue,H as me}from"./layout-oq7j7Zxl.js";import{I as w}from"./input-error-XFeId9F8.js";import{a as k,B as r}from"./button-D4rUH4JB.js";import{I as y}from"./input-Dc5R9TS5.js";import{L as C}from"./label-HbfnK1lI.js";import{C as t,a as c,b as o,c as n,d as i}from"./card-DF370HhO.js";import{A as l,a as u}from"./alert-zFhh9Z1D.js";import{B as q}from"./badge-BJmshktp.js";import{A as xe}from"./app-layout-DIP_2hnv.js";import{S as A,K as g}from"./shield-DxgXQXAr.js";import{C as S}from"./circle-check-big-C09TKG2P.js";/* empty css            */import"./separator-B3gyDKi7.js";import"./index-Cxkacx_1.js";import"./app-header-layout-DeCsVdE4.js";import"./index-CUR25A5V.js";import"./app-logo-icon-CJVXHink.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],h=k("Copy",pe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],H=k("ShieldCheck",he);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],v=k("TriangleAlert",je),ge=[{title:"Autenticación de 2 Factores",href:"/settings/two-factor"}];function qe({two_factor_enabled:F,two_factor_confirmed:ve,two_factor_setup:d,recovery_codes:j}){var z,I,P;const{flash:s,errors:be}=de().props,[L,b]=f.useState(!1),[B,D]=f.useState(!1),[N,R]=f.useState(null),{post:M,processing:T,reset:V}=p({}),{data:Q,setData:$,post:K,processing:_,errors:O,reset:U}=p({code:""}),{data:J,setData:W,delete:X,processing:E,errors:Y,reset:Z}=p({password:""}),{data:ee,setData:se,post:ae,processing:G,errors:re,reset:te}=p({password:""});p({password:""});const ce=a=>{a.preventDefault(),console.log("Enable 2FA button clicked"),console.log("Route:",route("two-factor.store")),M(route("two-factor.store"),{preserveScroll:!0,onSuccess:()=>{console.log("2FA enable success"),V()},onError:x=>{console.log("2FA enable error:",x)},onFinish:()=>{console.log("2FA enable finished")}})},oe=a=>{a.preventDefault(),K(route("two-factor.confirm"),{preserveScroll:!0,onSuccess:()=>{U(),b(!0)}})},ne=a=>{a.preventDefault(),X(route("two-factor.destroy"),{preserveScroll:!0,onSuccess:()=>Z()})},ie=a=>{a.preventDefault(),ae(route("two-factor.recovery-codes"),{preserveScroll:!0,onSuccess:()=>{te(),b(!0)}})},m=a=>{navigator.clipboard.writeText(a),R(a),setTimeout(()=>R(null),2e3)};return e.jsxs(xe,{breadcrumbs:ge,children:[e.jsx(le,{title:"Autenticación de 2 Factores"}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(me,{title:"Autenticación de 2 Factores",description:"Agrega una capa adicional de seguridad a tu cuenta"}),(s==null?void 0:s.status)==="two-factor-setup"&&e.jsxs(l,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(u,{children:"Escanea el código QR con tu aplicación de autenticación y confirma con un código."})]}),(s==null?void 0:s.status)==="two-factor-confirmed"&&e.jsxs(l,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(u,{children:"¡Autenticación de dos factores habilitada exitosamente! Guarda tus códigos de recuperación."})]}),(s==null?void 0:s.status)==="two-factor-disabled"&&e.jsxs(l,{children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx(u,{children:"Autenticación de dos factores deshabilitada."})]}),e.jsxs(t,{children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Estado Actual"]}),e.jsx(n,{children:"Estado de la autenticación de dos factores en tu cuenta"})]}),e.jsx(i,{children:e.jsx("div",{className:"flex items-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsxs(q,{variant:"default",className:"bg-green-100 text-green-800 border-green-200",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Habilitada"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Tu cuenta está protegida con autenticación de dos factores"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(q,{variant:"secondary",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"Deshabilitada"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Tu cuenta no tiene autenticación de dos factores"})]})})})]}),F?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(t,{children:[e.jsxs(c,{children:[e.jsx(o,{className:"text-red-600",children:"Deshabilitar Autenticación de 2 Factores"}),e.jsx(n,{children:"Esto eliminará la protección adicional de tu cuenta"})]}),e.jsx(i,{children:e.jsx("form",{onSubmit:ne,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"disable_password",children:"Contraseña Actual"}),e.jsx(y,{id:"disable_password",type:"password",value:J.password,onChange:a=>W("password",a.target.value),required:!0}),e.jsx(w,{message:Y.password,className:"mt-2"})]}),e.jsx(r,{type:"submit",variant:"destructive",disabled:E,children:E?"Deshabilitando...":"Deshabilitar"})]})})})]}),e.jsxs(t,{children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),"Gestionar Códigos de Recuperación"]}),e.jsx(n,{children:"Ver códigos actuales o generar nuevos códigos de recuperación"})]}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-4",children:e.jsx("form",{onSubmit:ie,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"recovery_password",children:"Generar Nuevos Códigos"}),e.jsx(y,{id:"recovery_password",type:"password",placeholder:"Contraseña actual",value:ee.password,onChange:a=>se("password",a.target.value),required:!0}),e.jsx(w,{message:re.password,className:"mt-2"})]}),e.jsx(r,{type:"submit",disabled:G,className:"w-full",children:G?"Generando...":"Generar Nuevos"})]})})}),e.jsxs(l,{children:[e.jsx(v,{className:"h-4 w-4"}),e.jsxs(u,{children:[e.jsx("strong",{children:"Importante:"})," Generar nuevos códigos invalidará todos los códigos anteriores."]})]})]})})]}),j&&j.length>0&&e.jsxs(t,{children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),"Tus Códigos de Recuperación Actuales"]}),e.jsx(n,{children:"Estos son tus códigos de recuperación de emergencia. Guárdalos en un lugar seguro."})]}),e.jsxs(i,{children:[e.jsxs(l,{className:"mb-4",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsxs(u,{children:[e.jsx("strong",{children:"Importante:"})," Cada código solo se puede usar una vez. Guárdalos en un lugar seguro."]})]}),B?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 gap-2 p-4 bg-muted rounded-lg font-mono text-sm",children:j.map((a,x)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-background rounded border",children:[e.jsx("span",{children:a}),e.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>m(a),children:N===a?e.jsx(S,{className:"h-4 w-4"}):e.jsx(h,{className:"h-4 w-4"})})]},x))}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs(r,{type:"button",variant:"outline",onClick:()=>{const a=j.join(`
`);m(a)},children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Copiar Todos"]}),e.jsx(r,{type:"button",variant:"outline",onClick:()=>D(!1),children:"Ocultar Códigos"})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-lg font-mono text-muted-foreground",children:"••••-•••• ••••-•••• ••••-•••• ••••-••••"}),e.jsx("div",{className:"text-lg font-mono text-muted-foreground",children:"••••-•••• ••••-•••• ••••-•••• ••••-••••"})]}),e.jsxs(r,{type:"button",onClick:()=>D(!0),className:"gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),"Mostrar Códigos de Recuperación"]})]})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[!(s!=null&&s.two_factor_setup||d)&&e.jsxs(t,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Habilitar Autenticación de 2 Factores"}),e.jsx(n,{children:"Protege tu cuenta con un código adicional de tu teléfono"})]}),e.jsx(i,{children:e.jsx("form",{onSubmit:ce,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cuando la autenticación de dos factores esté habilitada, se te pedirá un token seguro y aleatorio durante la autenticación. Puedes obtener este token desde la aplicación Google Authenticator de tu teléfono."}),e.jsx(r,{type:"submit",disabled:T,children:T?"Configurando...":"Habilitar"})]})})})]}),((s==null?void 0:s.two_factor_setup)||d)&&e.jsxs(t,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Configurar Aplicación de Autenticación"}),e.jsx(n,{children:"Escanea el código QR con Google Authenticator o ingresa la clave manualmente"})]}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"p-4 bg-white rounded-lg border",children:e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(((z=(s==null?void 0:s.two_factor_setup)||d)==null?void 0:z.qr_code_url)||"")}`,alt:"QR Code para 2FA",className:"w-48 h-48"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"O ingresa esta clave manualmente:"}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded font-mono text-sm",children:[e.jsx("span",{children:(I=(s==null?void 0:s.two_factor_setup)||d)==null?void 0:I.secret}),e.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>{var a;return m(((a=(s==null?void 0:s.two_factor_setup)||d)==null?void 0:a.secret)||"")},children:N===((P=(s==null?void 0:s.two_factor_setup)||d)==null?void 0:P.secret)?e.jsx(S,{className:"h-4 w-4"}):e.jsx(h,{className:"h-4 w-4"})})]})]})]}),e.jsx("form",{onSubmit:oe,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"code",children:"Código de Verificación"}),e.jsx(y,{id:"code",type:"text",placeholder:"123456",value:Q.code,onChange:a=>$("code",a.target.value),maxLength:6,required:!0}),e.jsx(w,{message:O.code,className:"mt-2"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Ingresa el código de 6 dígitos de tu aplicación de autenticación"})]}),e.jsx(r,{type:"submit",disabled:_,children:_?"Verificando...":"Confirmar"})]})})]})})]})]}),((s==null?void 0:s.recovery_codes)||L&&((s==null?void 0:s.status)==="recovery-codes-generated"||(s==null?void 0:s.status)==="recovery-codes-shown"||(s==null?void 0:s.status)==="two-factor-confirmed"))&&e.jsxs(t,{children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),"Códigos de Recuperación"]}),e.jsx(n,{children:"Guarda estos códigos en un lugar seguro. Cada código solo se puede usar una vez."})]}),e.jsxs(i,{children:[e.jsxs(l,{className:"mb-4",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsxs(u,{children:[e.jsx("strong",{children:"Importante:"})," Guarda estos códigos en un lugar seguro. Si pierdes el acceso a tu dispositivo de autenticación, estos códigos son la única forma de acceder a tu cuenta."]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 p-4 bg-muted rounded-lg font-mono text-sm",children:((s==null?void 0:s.recovery_codes)||[]).map((a,x)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-background rounded border",children:[e.jsx("span",{children:a}),e.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>m(a),children:N===a?e.jsx(S,{className:"h-3 w-3"}):e.jsx(h,{className:"h-3 w-3"})})]},x))}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs(r,{type:"button",variant:"outline",onClick:()=>{const a=((s==null?void 0:s.recovery_codes)||[]).join(`
`);m(a)},children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Copiar Todos"]}),e.jsx(r,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cerrar"})]})]})]})]})})]})}export{qe as default};
