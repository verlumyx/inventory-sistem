import{u as X,r as C,j as e,H as Y,L as Z,a as $}from"./app-BndNHLne.js";import{B as i}from"./button-B938siKt.js";import{C as h,a as j,b as u,c as A,d as p}from"./card-BXOJrilN.js";import{I as P}from"./input-7eto-rc8.js";import{L as g}from"./label-CIW_vp9F.js";import{S as k,a as L,b as D,c as H,d as B,P as E}from"./select-WmQj3lC4.js";import{T as W,a as ee,b as S,c,d as se,e as l}from"./table-BlxktNVL.js";import{A as ae}from"./authenticated-layout-o3ZVkSEy.js";import{A as te}from"./arrow-left-BYeRaKVa.js";import{e as R,P as V}from"./app-header-layout-DF_mBwyX.js";import{T as re}from"./trash-2-B5pYzJ2D.js";import{C as le}from"./calculator-Bjrp1gsf.js";/* empty css            */import"./index-DI4Ye8VL.js";import"./index-QVslWZ3W.js";import"./check-BCEkxITN.js";import"./app-logo-icon-Dajt3FdR.js";function Ce({warehouses:z,items:f,defaultWarehouse:N}){var F;const{data:r,setData:b,post:G,processing:w,errors:n}=X({warehouse_id:((F=N==null?void 0:N.id)==null?void 0:F.toString())||"",items:[]}),[d,I]=C.useState(""),[m,T]=C.useState(""),[o,v]=C.useState(""),_=()=>r.items.reduce((s,a)=>s+a.amount*a.price,0),O=()=>{if(!d||!m||!o)return;const s=parseInt(d),a=parseFloat(m),t=parseFloat(o);if(r.items.some(Q=>Q.item_id===s)){alert("Este item ya está agregado a la factura");return}const y={item_id:s,amount:a,price:t,subtotal:a*t};b("items",[...r.items,y]),I(""),T(""),v("")},U=s=>{const a=r.items.filter((t,y)=>y!==s);b("items",a)},q=s=>{I(s);const a=f.find(t=>t.id===parseInt(s));a&&v(a.price.toString())},J=s=>{if(s.preventDefault(),r.items.length===0){alert("Debe agregar al menos un item a la factura");return}G(route("invoices.store"))},x=s=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"USD"}).format(s),K=s=>f.find(a=>a.id===s),M=[{title:"Panel de Control",href:"/dashboard"},{title:"Facturas",href:"/invoices"},{title:"Crear Factura",href:"/invoices/create",current:!0}];return e.jsxs(ae,{breadcrumbs:M,children:[e.jsx(Y,{title:"Nueva Factura"}),e.jsx("div",{className:"space-y-6 p-6 space-y-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:"Crear nueva factura"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completa la información para crear un nueva factura"})]}),e.jsx(Z,{href:"/invoices",children:e.jsxs(i,{variant:"outline",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Volver"]})})]})}),e.jsx("div",{className:"",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Información General"]}),e.jsx(A,{children:"Selecciona el almacén para la factura"})]}),e.jsx(p,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(g,{htmlFor:"warehouse_id",children:"Almacén *"}),e.jsxs(k,{value:r.warehouse_id.toString(),onValueChange:s=>b("warehouse_id",s),children:[e.jsx(L,{children:e.jsx(D,{placeholder:"Seleccionar almacén"})}),e.jsx(H,{children:z.map(s=>e.jsx(B,{value:s.id.toString(),children:s.display_name},s.id))})]}),n.warehouse_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.warehouse_id})]})})]}),e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Agregar Items"]}),e.jsx(A,{children:"Agrega items a la factura de forma rápida y dinámica"})]}),e.jsx(p,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"item_select",children:"Item"}),e.jsxs(k,{value:d,onValueChange:q,children:[e.jsx(L,{children:e.jsx(D,{placeholder:"Seleccionar item"})}),e.jsx(H,{children:f.map(s=>e.jsx(B,{value:s.id.toString(),children:s.display_name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"amount",children:"Cantidad"}),e.jsx(P,{id:"amount",type:"number",step:"0.01",min:"0.01",placeholder:"0.00",value:m,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"price",children:"Precio"}),e.jsx(P,{id:"price",type:"number",step:"0.01",min:"0.01",placeholder:"0.00",value:o,onChange:s=>v(s.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(i,{type:"button",onClick:O,disabled:!d||!m||!o,className:"w-full",children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Agregar"]})})]})})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Items de la Factura (",r.items.length,")"]})}),e.jsxs(p,{children:[r.items.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(V,{className:"mx-auto mb-4 h-12 w-12 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No hay items agregados"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Agrega items usando el formulario de arriba"})]}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(W,{children:[e.jsx(ee,{children:e.jsxs(S,{children:[e.jsx(c,{children:"Item"}),e.jsx(c,{className:"text-right",children:"Cantidad"}),e.jsx(c,{className:"text-right",children:"Precio"}),e.jsx(c,{className:"text-right",children:"Subtotal"}),e.jsx(c,{className:"w-[100px]",children:"Acciones"})]})}),e.jsxs(se,{children:[r.items.map((s,a)=>{const t=K(s.item_id);return e.jsxs(S,{children:[e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t==null?void 0:t.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t==null?void 0:t.code," • ",t==null?void 0:t.unit]})]})}),e.jsx(l,{className:"text-right",children:Number(s.amount).toFixed(2)}),e.jsx(l,{className:"text-right",children:x(s.price)}),e.jsx(l,{className:"text-right font-medium",children:x(s.amount*s.price)}),e.jsx(l,{children:e.jsx(i,{type:"button",variant:"ghost",size:"sm",onClick:()=>U(a),children:e.jsx(re,{className:"h-4 w-4 text-red-500"})})})]},a)}),e.jsxs(S,{className:"border-t-2 bg-gray-50",children:[e.jsx(l,{colSpan:3,className:"text-right font-bold",children:"TOTAL:"}),e.jsx(l,{className:"text-right",children:e.jsx("span",{className:"text-xl font-bold text-green-600",children:x(_())})}),e.jsx(l,{})]})]})]})}),n.items&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.items})]})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Resumen"]})}),e.jsxs(p,{children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Total de Items: ",r.items.length]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["Total: ",x(_())]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(i,{type:"submit",disabled:w||r.items.length===0,className:"flex-1",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),w?"Creando...":"Crear Factura"]}),e.jsx(i,{type:"button",variant:"outline",onClick:()=>$.visit(route("invoices.index")),children:"Cancelar"})]})]})]})]})})})]})}export{Ce as default};
